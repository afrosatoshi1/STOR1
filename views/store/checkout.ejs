<!DOCTYPE html><html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="stylesheet" href="/css/styles.css"/>
<script src="https://js.paystack.co/v1/inline.js"></script>
<title>Checkout - NeoTech</title></head><body>
<%- include('../partials/header', { user }) %>
<h1 class="hero">Checkout</h1>
<div class="grid" style="grid-template-columns:2fr 1fr">
  <div class="card">
    <h3>Items</h3>
    <ul>
      <% cart.forEach(i => { %>
        <li><%= i.qty %> × <%= i.name %> — ₦<%= (i.price*i.qty).toLocaleString() %></li>
      <% }) %>
    </ul>
  </div>
  <div class="card">
    <h3>Pay</h3>
    <p>Total: <strong>₦<%= total.toLocaleString() %></strong></p>
    <% if (!paystackKey) { %><div class="alert">Paystack key not set. Add PAYSTACK_PUBLIC_KEY in Render → Environment.</div><% } %>
    <button class="btn" onclick="pay()">Pay with Paystack</button>
  </div>
</div>
<script>
function pay(){
  var handler = PaystackPop.setup({
    key: '<%= paystackKey || "" %>',
    email: '<%= user.email %>',
    amount: <%= (total*100) %>,
    currency: 'NGN',
    ref: ''+Math.floor((Math.random() * 1000000000) + 1),
    callback: function(response){ window.location = '/checkout/verify?reference=' + response.reference; },
    onClose: function(){ alert('Payment cancelled'); }
  });
  handler.openIframe();
}
</script>
</body></html>
